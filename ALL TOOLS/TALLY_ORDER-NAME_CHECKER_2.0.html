<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { 
  font-family: 'Segoe UI', sans-serif; 
  background: #f0f2f5; 
  padding: 30px; 
  margin: 0; 
  color: #111;
}
h2 { 
  text-align: center; 
  color: #333; 
  margin-bottom: 30px;
}

.container { 
  display: flex; 
  gap: 20px; 
  flex-wrap: nowrap;
  margin-left: 30px; 
  margin-right: 20px; 
}

.left { 
  flex: 0 0 30%; 
  min-width: 250px; 
  background: #fff; 
  padding: 20px; 
  border-radius: 12px; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  height: fit-content;
}

.right { 
  flex: 0 0 70%; 
  min-width: 350px; 
  background: #fff; 
  padding: 20px; 
  border-radius: 12px; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
  box-sizing: border-box;
  overflow-x: auto; 
  text-align: center;
}

h3 { 
  margin-top: 0; 
  margin-bottom: 12px; 
  color: #1976d2; 
}

textarea, select { 
  width: 100%; 
  padding: 12px; 
  font-size: 14px; 
  border-radius: 8px; 
  border: 1px solid #ccc; 
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
  resize: vertical;
  margin-bottom: 12px;
}
select { cursor: pointer; }

button { 
  padding: 12px 24px; 
  font-size: 14px; 
  border: none; 
  border-radius: 8px; 
  background: #1976d2; 
  color: white; 
  cursor: pointer; 
  transition: background 0.3s, transform 0.2s;
}
button:hover { 
  background: #1565c0; 
  transform: translateY(-2px);
}

#summary table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  border-radius: 8px;
  overflow: hidden;
}
#summary th, #summary td {
  width: 25%;
  padding: 10px;
  font-size: 14px;
  text-align: center;
}
#summary th {
  background:#1976d2;
  color:white;
}

#output table {
  width: 100%; 
  border-collapse: collapse; 
  margin-top: 10px; 
  border-radius: 8px; 
  overflow: hidden; 
  text-align: left;
}
#output th, #output td {
  padding:10px; 
  font-size: 13px;
}
#output th {
  background:#1976d2;
  color:white;
}
tr.match td { background:#c8e6c9; }
tr:hover td { background: #f1f1f1; }

#missing { 
  margin: 20px 0; 
  padding: 12px; 
  background: #fff3e0; 
  border-radius: 8px; 
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  text-align: left; 
}

.left textarea { 
  max-height: 350px; 
  overflow-y: auto;
  box-sizing: border-box;
}

@media (max-width: 900px) { 
  .container { flex-direction: column; margin-left: 0; } 
  .left, .right { flex: 1 1 100%; min-width: 100%; }
}

.missing-grid {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.missing-box {
  flex: 1 1 45%;
  background: #fff;
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.missing-box h4 {
  margin: 0 0 8px 0;
  font-size: 14px;
}

.missing-box ul {
  margin: 0;
  padding-left: 18px;
  font-size: 13px;
}
</style>
</head>
<body>

<h2>WEBSITE NAME CHECKER</h2>

<div class="container">
  <div class="left">
    <h3>Select Page</h3>
    <select id="pageSelect"></select>

    <h3>Paste Website Names</h3>
    <textarea id="input" placeholder="One name per line..."></textarea>
    <button onclick="processData()">CHECK</button>
  </div>

  <div class="right">
    <div id="summary"></div>
    <div id="missing"></div>
    <div id="output">Paste data and select page.</div>
  </div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwxV3WrsZoUCd6HcYYI3Fw_MSAJzAtHqmmbdu55pMtS3m_nJMjg254pd-FnMjrxt5C_1g/exec";
let sheetData = [];

fetch(WEB_APP_URL)
  .then(res => res.json())
  .then(data => {
      sheetData = data;
      populateDropdown();
  })
  .catch(err => document.getElementById("output").innerText = "Error fetching sheet data.");

function populateDropdown() {
    const select = document.getElementById("pageSelect");
    const pages = sheetData[0];
    pages.forEach((p, idx) => {
        if(p) {
            const option = document.createElement("option");
            option.value = idx;
            option.textContent = p; 
            select.appendChild(option);
        }
    });
}

function processData() {
    const raw = document.getElementById("input").value.trim();
    const outputDiv = document.getElementById("output");
    const missingDiv = document.getElementById("missing");
    const summaryDiv = document.getElementById("summary");
    
    if(!raw) {
        outputDiv.innerHTML = "No names pasted.";
        missingDiv.innerHTML = "";
        summaryDiv.innerHTML = "";
        return;
    }

    const selectedIndex = document.getElementById("pageSelect").value;
    if(selectedIndex === "") {
        outputDiv.innerHTML = "Please select a page.";
        missingDiv.innerHTML = "";
        summaryDiv.innerHTML = "";
        return;
    }

    const namesToCheck = raw.split("\n").map(n => n.trim()).filter(n => n !== "");
    const colIndex = parseInt(selectedIndex); 
    const pageNames = sheetData.slice(1).map(r => r[colIndex]).filter(n => n); 
    const numberRow1 = sheetData[0][colIndex]; 

    const totalPaste = namesToCheck.length;
    const totalSheet = pageNames.length;

    // Missing items
    const missingPaste = namesToCheck.filter(n => !pageNames.some(p => p.toLowerCase() === n.toLowerCase()));
    const missingSheet = pageNames.filter(p => !namesToCheck.some(n => n.toLowerCase() === p.toLowerCase()));
	missingSheet.sort((a, b) => a.localeCompare(b));


    // ===== Summary =====
    let summaryHtml = "<table>";
    summaryHtml += `<tr style="background:#1976d2; color:white;">
                        <td>Page Name</td>
                        <td>Website</td>
                        <td>GSheet</td>
                        <td>Status</td>
                     </tr>`;

    const hasMissing = missingPaste.length > 0 || missingSheet.length > 0;
    const statusColor = (totalPaste === totalSheet && !hasMissing) ? "#a5d6a7" : "#ef9a9a";
    const statusText = (totalPaste === totalSheet && !hasMissing) ? "MATCH âœ”" : "NOT MATCH âœ–";

    summaryHtml += `<tr style="background:${statusColor}; color:#111;">
                        <td>${numberRow1}</td>
                        <td>${totalPaste}</td>
                        <td>${totalSheet}</td>
                        <td>${statusText}</td>
                    </tr>`;
    summaryHtml += "</table>";
    summaryDiv.innerHTML = summaryHtml;

    // Missing section
    let missingHtml = "";

if (missingPaste.length || missingSheet.length) {
    missingHtml += `<h3>Missing</h3>
        <div class="missing-grid">

            <div class="missing-box">
                <h4>IN GSHEET (${missingPaste.length})</h4>
                <ul>
                    ${
                      missingPaste.length
                        ? missingPaste.map(n => `<li>${n}</li>`).join("")
                        : "<li>None ðŸŽ‰</li>"
                    }
                </ul>
            </div>

            <div class="missing-box">
                <h4>IN WEBSITE (${missingSheet.length})</h4>
                <ul>
                    ${
                      missingSheet.length
                        ? missingSheet.map(p => `<li>${p}</li>`).join("")
                        : "<li>None ðŸŽ‰</li>"
                    }
                </ul>
            </div>

        </div>`;
}

missingDiv.innerHTML = missingHtml;


    // Match details - only show matches
    let html = "<table>";
    html += "<tr><th>Name</th><th>Status</th></tr>";
    namesToCheck.forEach(name => {
        const match = pageNames.some(p => p.toLowerCase() === name.toLowerCase());
        if(match){
            html += `<tr class="match">
                        <td>${name}</td>
                        <td>MATCH âœ”</td>
                     </tr>`;
        }
    });
    html += "</table>";
    outputDiv.innerHTML = html || "No matches found.";
}
</script>

</body>
</html>

